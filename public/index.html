<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üíß Faucet-Cash</title>
<style>
body {
  font-family: 'Segoe UI', sans-serif;
  background-color: #0f172a;
  color: #e2e8f0;
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
}
header {
  background: #1e293b;
  width: 100%;
  text-align: center;
  padding: 15px;
  font-size: 1.5rem;
  color: #38bdf8;
  box-shadow: 0 2px 10px rgba(0,0,0,0.3);
}
.card {
  background: #1e293b;
  border-radius: 12px;
  padding: 20px;
  margin: 20px;
  width: 90%;
  max-width: 400px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.5);
  transition: transform 0.3s;
}
.card:hover { transform: translateY(-5px); }
button {
  background: #38bdf8;
  border: none;
  padding: 10px 15px;
  border-radius: 8px;
  color: #0f172a;
  font-weight: bold;
  cursor: pointer;
  transition: 0.3s;
}
button:hover { background: #0ea5e9; }
input, select { width: 100%; padding: 8px; margin-bottom: 10px; border-radius: 6px; border: none; }
h4 { margin-bottom: 10px; }
.task { border-bottom: 1px solid #334155; padding: 10px 0; margin-bottom: 5px; border-radius: 6px; background: #1e293b; }
.task button { margin-top: 5px; width: 100%; }
.alert { background:#10b981; color:#0f172a; padding:8px; border-radius:6px; margin-bottom:10px; text-align:center; animation: fadeOut 2s forwards 1s;}
@keyframes fadeOut { from {opacity:1;} to {opacity:0; height:0; margin:0; padding:0;} }
@media (max-width:500px){ .card { width:95%; margin:10px; } }
</style>
</head>
<body>
<header>üíß Faucet-Cash</header>

<div id="login" class="card">
  <h3>üîê Zaloguj siƒô</h3>
  <input id="username" placeholder="Login" />
  <input id="password" type="password" placeholder="Has≈Ço" />
  <button onclick="login()">Zaloguj</button>
  <p id="msg"></p>
</div>

<div id="dashboard" class="card" style="display:none;">
  <h3>üëã Witaj, <span id="userName"></span></h3>
  <p>Punkty: <span id="points"></span></p>
  <button onclick="logout()">üö™ Wyloguj</button>
  <div id="tasks"></div>

  <div id="adminPanel" style="display:none; margin-top:20px;">
    <h4>üõ† Panel Admina</h4>
    <div class="card">
      <h4>Dodaj nowe zadanie</h4>
      <input id="taskTitle" placeholder="Tytu≈Ç zadania" />
      <input id="taskDesc" placeholder="Opis" />
      <input id="taskPoints" placeholder="Punkty" type="number" />
      <select id="taskType">
        <option value="visit">Odwied≈∫ stronƒô</option>
        <option value="ads">OglƒÖdaj reklamy</option>
        <option value="captcha">RozwiƒÖ≈º captcha</option>
      </select>
      <button onclick="addTask()">Dodaj zadanie</button>
    </div>
    <div class="card">
      <h4>Lista u≈ºytkownik√≥w</h4>
      <ul id="userList"></ul>
    </div>
  </div>
</div>

<script>
const api = 'http://localhost:4000/api';
let currentUser = null;

async function login() {
  const username=document.getElementById('username').value;
  const password=document.getElementById('password').value;
  const res = await fetch(api+'/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username,password})});
  const data = await res.json();
  if(data.success){
    currentUser = data.user;
    document.getElementById('login').style.display='none';
    document.getElementById('dashboard').style.display='block';
    document.getElementById('userName').textContent=currentUser.username;
    document.getElementById('points').textContent=currentUser.points;
    loadTasks();
    if(currentUser.role==='admin'){
      document.getElementById('adminPanel').style.display='block';
      loadUsers();
    }
  } else {
    document.getElementById('msg').textContent=data.error;
  }
}

async function loadTasks(){
  const res=await fetch(api+'/tasks');
  const tasks=await res.json();
  const container=document.getElementById('tasks');
  container.innerHTML='<h4>üß© Zadania:</h4>';
  tasks.forEach(t=>{
    const div=document.createElement('div');
    div.className='task';
    div.innerHTML=`<b>${t.title}</b><br>${t.description}<br>Nagroda: ${t.points} pkt<br>
      <button onclick="claim(${t.id})">Odbierz punkty</button>`;
    container.appendChild(div);
  });
}

async function claim(id){
  const res=await fetch(api+'/claim',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({username:currentUser.username,taskId:id})
  });
  const data = await res.json();
  if(data.success){
    currentUser.points=data.newPoints;
    document.getElementById('points').textContent=currentUser.points;
    showAlert('‚úÖ Punkty dodane!');
  }
}

function showAlert(msg){
  const alertDiv=document.createElement('div');
  alertDiv.className='alert';
  alertDiv.textContent=msg;
  document.body.insertBefore(alertDiv,document.getElementById('dashboard'));
  setTimeout(()=>alertDiv.remove(),2500);
}

function logout(){
  currentUser=null;
  document.getElementById('dashboard').style.display='none';
  document.getElementById('login').style.display='block';
}

// ADMIN FUNCTIONS
async function addTask(){
  const title=document.getElementById('taskTitle').value;
  const desc=document.getElementById('taskDesc').value;
  const points=parseInt(document.getElementById('taskPoints').value);
  const type=document.getElementById('taskType').value;
  const res = await fetch(api+'/add-task',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({title,description:desc,points,type})
  });
  const data=await res.json();
  if(data.success){
    showAlert('‚úÖ Zadanie dodane!');
    loadTasks();
  }
}

async function loadUsers(){
  const res=await fetch(api+'/users');
  const users=await res.json();
  const ul=document.getElementById('userList');
  ul.innerHTML='';
  users.forEach(u=>{
    const li=document.createElement('li');
    li.textContent=`${u.username} - ${u.points} pkt - ${u.role}`;
    ul.appendChild(li);
  });
}

// REFRESH POINTS EVERY 5 SECONDS
setInterval(()=>{
  if(currentUser){
    fetch(api+'/users').then(res=>res.json()).then(users=>{
      const user=users.find(u=>u.username===currentUser.username);
      if(user) document.getElementById('points').textContent=user.points;
    });
  }
},5000);

</script>
</body>
</html>
